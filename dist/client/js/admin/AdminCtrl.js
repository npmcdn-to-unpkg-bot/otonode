angular.module("oto").controller("UsersCtrl",["$rootScope","$scope","Users","Auth",function(a,b,c,d){b.loading=!0,b.userRoles=d.userRoles,b.master={},b.user={},b.user.role=b.userRoles.user,b.userFormState={action:"add",loadedIndex:null,errorAlreadyExists:!1,errorFillAll:!1},c.getAll(function(a){b.users=a,b.loading=!1},function(c){a.error="Failed to fetch users.",b.loading=!1}),b.update=function(a){b.master=angular.copy(a)},b.isUnchanged=function(a){return angular.equals(a,b.master)},b.userFormAction=function(a){"add"===b.userFormState.action?b.addUser(a):b.confirmUpdate()},b.addUser=function(a){c.add(a,function(a){b.users.push(a),b.resetForm()},function(a){"Username already exists"==a?b.userFormState.errorAlreadyExists=!0:"Please fill all the required fields"==a?b.userFormState.errorFillAll=!0:console.log(a)})},b.updateUser=function(a){b.userFormState.action="save",b.user=angular.copy(b.users[a]),b.user.role=b.userRoles[b.user.role.title],b.master=angular.copy(b.user),b.userFormState.loadedIndex=a},b.confirmUpdate=function(){c.update(b.user,function(a){b.users[b.userFormState.loadedIndex]=a,b.resetForm()},function(a){"Username already exists"==a?b.userFormState.errorAlreadyExists=!0:"Please fill all the required fields"==a?b.userFormState.errorFillAll=!0:console.log(a)})},b.resetForm=function(){b.user={},b.user.role=b.userRoles.user,b.userFormState={action:"add",loadedIndex:null,errorAlreadyExists:!1}},b.deleteUser=function(a){c.remove(a,function(c){b.users.splice(b.users.indexOf(a),1)},function(a){console.log(a)})}}]),angular.module("oto").controller("DBCtrl",["$scope","$http",function(a,b){a.exportok=!1,a.exporterror=!1,a.exportprogress=!1,a.exportDB=function(){a.exportprogress=!0,b.get("/exportdb").success(function(b){a.exportprogress=!1,a.exportok=!0}).error(function(b){a.exportprogress=!1,a.exporterror=!0})}}]);