"use strict";angular.module("oto").controller("CardListCtrl",["$scope","$filter","Cards",function(a,b,c){function d(){var c,d={},e=a.cards;e=b("handlearchive")(e,a.inArchive()),e=b("bystackid")(e,a.search,a.inArchive()),e=b("filter")(e,a.query),angular.forEach(e,function(b){c="title"===a.orderProp?b.title.substring(0,1).toUpperCase():getDateNoTime(b[a.orderProp.replace("-","")]),d[c]?d[c].push(b):d[c]=[b]}),a.cardGroups=[],angular.forEach(d,function(c,d){c=b("orderBy")(c,a.orderProp),a.cardGroups.push({label:d,cards:c})}),"title"===a.orderProp?a.cardGroups=b("orderBy")(a.cardGroups,"label"):a.cardGroups=b("orderBy")(a.cardGroups,"-label")}a.selectCard=function(a){c.getActiveCard()==a?c.setActiveCard(null):c.setActiveCard(a)},a.cardIsActive=function(a){return a==c.getActiveCard()?!0:!1},a.startEditCard=function(b){a.inArchive()||(window.getSelection?window.getSelection().removeAllRanges():document.selection&&document.selection.empty(),c.cardFormCard=b,c.showForm=!0)},a.$watch("cards",function(){d()},!0),a.$watchCollection("[orderProp,activestack.title,query]",function(){d()}),a.attDownloadSrc=function(a){return a.image?a.image.original.defaultUrl:a.pdf?a.pdf.original.defaultUrl:a["default"]?a["default"].original.defaultUrl:a.url?a.url:!1},a.attThumbSrc=function(a){return a.image?a.image.thumb.defaultUrl:a.pdf?a.pdf.thumb.defaultUrl:a.urlThumb?a.urlThumb:"/img/nothumb.png"}}]);