"use strict";angular.module("oto").controller("NotesViewCtrl",["$scope","$uibModal","Stacks","Cards",function(a,b,c,d){a.activestack={title:"",_id:""},a.orderProp="-modifiedat",a.setOrder=function(b){a.orderProp=b},a.activeCard=d.activeCard,a.Cards=d,a.$watch("Cards.cardFormCard",function(b){a.cardFormCard=b},!0),a.showForm=!1,a.$watch("Cards.showForm",function(b){a.showForm=b}),a.inArchive=function(){return"archive"===a.activestack._id},a.getStacktitle=function(b){var c=a.stacks.filter(function(a){if(a._id===b)return a});return 1===c.length?c[0].title:"Floating"},a.stacks=[],a.floatingStack=a.activestack={title:"Floating"},c.getAll(function(b,d){a.stacks=b,a.floatingStack=d,a.search=d._id,a.activestack=d,c.activeStack=d}),a.cards=[],a.$watch("Cards.cards",function(b){a.cards=b},!0),d.getAll(function(b){d.cards=b,a.cardGroups=[{label:"unsorted",cards:a.cards}]},function(a){console.log(a)}),a.startAddCard=function(){if(!a.inArchive()){var b={_id:"new"+makeid(),title:"",content:"",duedate:"",fileattachments:[],urlattachments:[]};d.cardFormCard=b,d.showForm=!0}},a.startEditCard=function(b){a.inArchive()||(d.cardFormCard=b,d.showForm=!0)},a.removeCard=function(b){d.setCardFormCard(null),a.inArchive()?d.remove(b._id,function(){a.cards.splice(a.cards.indexOf(b),1)},function(a){console.log(a)}):d.archive(b._id,a.getStacktitle(b.stackid),function(c){a.cards[a.cards.indexOf(b)]=c},function(a){console.log(a)})},a.moveCard=function(b,c){d.move(b._id,c,function(c){a.cards[a.cards.indexOf(b)]=c},function(a){console.log(a)})},a.openDetails=function(a){b.open({templateUrl:"/js/notes/cardDetailsModal.html",controller:CardDetailsModalInstanceCtrl,resolve:{card:function(){return a}}})},a.isNotNull=function(a){return null!=a},a.dropdown=function(a){$(a).dropdown("toggle")}}]);var CardDetailsModalInstanceCtrl=function(a,b,c){a.card=c,a.ok=function(){b.close()}};CardDetailsModalInstanceCtrl.$inject=["$scope","$uibModalInstance","card"];