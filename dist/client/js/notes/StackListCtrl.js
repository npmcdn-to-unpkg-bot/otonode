"use strict";angular.module("oto").controller("StackListCtrl",["$scope","$filter","Stacks","Cards",function(a,b,c,d){a.stackActionError=!1,a.stackActionErrorMsg="",a.stackSizes={},a.$watch("[cards, stacks]",function(){jQuery.each(a.stacks,function(b,c){var d=0;jQuery.each(a.cards,function(a,b){b.stackid!==c._id||b.archivedat||d++}),a.stackSizes[c._id]=d})},!0),a.stackIsActive=function(b){return b==a.activestack.title},a.stackIsEditable=function(){return"Floating"==a.$parent.activestack.title||"Archive"==a.$parent.activestack.title||"All"==a.$parent.activestack.title},a.startAddStack=function(){a.addStackInput="",a.isVisibleStackAdd=!0},a.startRenameStack=function(b){a.renameStackInput="",a.isVisibleStackAdd=!1,a.isVisibleStackRename=!0,a.isVisibleStackDelete=!1,a.stackToRename=b},a.startDeleteStack=function(b){a.isVisibleStackAdd=!1,a.isVisibleStackRename=!1,a.isVisibleStackDelete=!0,a.stackToDelete=b},a.addStack=function(){c.add(a.addStackInput,function(b){a.stacks.push(b),a.isVisibleStackAdd=!1,a.stackSizes[b._id]=0},function(b){11e3==b.code&&(a.stackActionError=!0,a.stackActionErrorMsg="Stack with that title already exists")})},a.renameStack=function(){c.rename(a.stackToRename._id,a.renameStackInput,function(b){a.stacks[a.stacks.indexOf(a.stackToRename)]=b,a.isVisibleStackRename=!1,a.$parent.activestack._id==b._id&&(a.$parent.activestack.title=b.title),c.activeStack=b},function(b){11e3==b.code&&(a.stackActionError=!0,a.stackActionErrorMsg="Stack with that title already exists")})},a.deleteStack=function(){var e=b("filter")(a.cards,{stackid:a.stackToDelete._id});jQuery.each(e,function(c,e){d.archive(e._id,a.stackToDelete.title,function(c){var d=b("filter")(a.cards,{id:c._id});a.cards[a.cards.indexOf(d[0])]=angular.copy(c)},function(a){console.log(a)})}),c.remove(a.stackToDelete._id,function(){a.stacks.splice(a.stacks.indexOf(a.stackToDelete),1),a.isVisibleStackDelete=!1,a.$parent.activestack._id==a.stackToDelete._id&&a.listStackUser(a.$parent.floatingStack)},function(a){console.log(a)})},a.listStackUser=function(b){d.setActiveCard(null),a.$parent.search=b._id,a.$parent.activestack=b,c.activeStack=b},a.listStackAll=function(){d.setActiveCard(null),a.$parent.search=null,a.$parent.activestack={owner:null,title:"All",_id:null},c.activeStack={owner:null,title:"All",_id:null}},a.listStackArchive=function(){d.setActiveCard(null),a.$parent.search="archive",a.$parent.activestack={title:"Archive",_id:"archive"},c.activeStack={title:"Archive",_id:"archive"}}}]);